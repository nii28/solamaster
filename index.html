<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SOLA Master Pro v3 - Pháp Khí Dịch Thuật</title>

<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">

<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        gold:'#ffd700',
        cyan:'#00f2ff'
      }
    }
  }
}
</script>

<style>
body{
  background:linear-gradient(135deg,#0f0c29,#302b63,#24243e);
  color:#e0e0e0;
  font-family:Inter,sans-serif;
  overflow:hidden
}
.glass-panel{
  background:rgba(20,20,40,.75);
  backdrop-filter:blur(12px);
  border:1px solid rgba(255,255,255,.1)
}
.glass-input{
  background:rgba(0,0,0,.3);
  border:1px solid rgba(255,255,255,.1);
  color:white
}
.tab-content{display:none;height:100%}
.tab-content.active{display:flex;flex-direction:column}
.nav-item.active{
  border-left:3px solid #ffd700;
  color:#ffd700
}
.magic-spinner{
  border:3px solid rgba(255,255,255,.1);
  border-left-color:#00f2ff;
  border-radius:50%;
  width:24px;height:24px;
  animation:spin 1s linear infinite
}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body class="h-screen flex flex-col">

<header class="glass-panel h-14 flex justify-between items-center px-6">
  <h1 class="text-xl font-bold">SOLA <span class="text-cyan-400">MASTER PRO v3</span></h1>
  <div class="flex gap-4 items-center">
    <button onclick="toggleFullscreen()"><i class="fa fa-expand"></i></button>
    <button onclick="resetApp()"><i class="fa fa-rotate-right"></i></button>
    <div id="api-status" class="text-xs px-2 py-1 bg-red-900/50 rounded">Chưa kết nối</div>
  </div>
</header>

<div class="flex flex-1 overflow-hidden">
<nav class="glass-panel w-16 md:w-64 flex flex-col py-4">
<button onclick="switchTab('tab-translate')" id="btn-tab-translate" class="nav-item active px-4 py-2">Dịch</button>
<button onclick="switchTab('tab-epub')" id="btn-tab-epub" class="nav-item px-4 py-2">TXT</button>
<button onclick="switchTab('tab-analyze')" id="btn-tab-analyze" class="nav-item px-4 py-2">Giải mã</button>
<button onclick="switchTab('tab-cleaner')" id="btn-tab-cleaner" class="nav-item px-4 py-2">Cleaner</button>
<button onclick="switchTab('tab-settings')" id="btn-tab-settings" class="nav-item px-4 py-2 mt-auto">Settings</button>
</nav>

<main class="flex-1 p-4 overflow-hidden">

<!-- TRANSLATE -->
<div id="tab-translate" class="tab-content active gap-4 h-full">
<textarea id="trans-input" class="glass-input flex-1 p-4" placeholder="Nhập văn bản..."></textarea>
<button onclick="executeMagic('translate')" class="bg-indigo-600 p-3 rounded">Dịch</button>
<textarea id="trans-output" class="glass-input flex-1 p-4" readonly></textarea>
<div id="loading-translate" class="hidden"><div class="magic-spinner"></div></div>
</div>

<!-- TXT -->
<div id="tab-epub" class="tab-content gap-4 h-full">
<input type="file" accept=".txt" onchange="handleFileUpload(this)">
<button onclick="translateCurrentChapter()" class="bg-emerald-600 p-2 rounded">Dịch</button>
<div class="flex gap-2 h-full">
<div id="reader-raw" class="flex-1 glass-panel p-4 overflow-y-auto"></div>
<div id="reader-trans" class="flex-1 glass-panel p-4 overflow-y-auto"></div>
</div>
</div>

<!-- ANALYZE -->
<div id="tab-analyze" class="tab-content gap-4 h-full">
<textarea id="analyze-input" class="glass-input flex-1 p-4"></textarea>
<button onclick="executeMagic('analyze')" class="bg-pink-600 p-2 rounded">Phân tích</button>
<div id="analyze-output" class="glass-panel p-4 flex-1"></div>
<div id="loading-analyze" class="hidden"><div class="magic-spinner"></div></div>
</div>

<!-- CLEANER -->
<div id="tab-cleaner" class="tab-content gap-4 h-full">
<textarea id="cleaner-input" class="glass-input flex-1 p-4"></textarea>
<button onclick="cleanText('html')" class="bg-slate-700 p-2">Xóa HTML</button>
<textarea id="cleaner-output" class="glass-input flex-1 p-4"></textarea>
</div>

<!-- SETTINGS -->
<div id="tab-settings" class="tab-content gap-4 h-full items-center justify-center">
<input type="password" id="api-key-input" class="glass-input p-3 w-80" placeholder="Gemini API Key">
<button onclick="saveSettings()" class="bg-gold text-black p-3 rounded">Save</button>
</div>

</main>
</div>

<script>
const API_URL="https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent";
let API_KEY="",chapters=[],currentChapter=0;

function switchTab(id){
document.querySelectorAll(".tab-content").forEach(t=>t.classList.remove("active"));
document.querySelectorAll(".nav-item").forEach(b=>b.classList.remove("active"));
document.getElementById(id).classList.add("active");
document.getElementById("btn-"+id).classList.add("active");
}

function toggleFullscreen(){
document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen();
}

function resetApp(){location.reload()}

function saveSettings(){
API_KEY=document.getElementById("api-key-input").value;
localStorage.setItem("API_KEY",API_KEY);
updateApiStatus();
}

function loadSettings(){
API_KEY=localStorage.getItem("API_KEY")||"";
document.getElementById("api-key-input").value=API_KEY;
updateApiStatus();
}

function updateApiStatus(){
document.getElementById("api-status").textContent=API_KEY?"Đã kết nối":"Chưa kết nối";
}

async function callGemini(prompt){
const r=await fetch(API_URL+"?key="+API_KEY,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({contents:[{parts:[{text:prompt}]}]})
});
const j=await r.json();
return j.candidates?.[0]?.content?.parts?.[0]?.text||"";
}

async function executeMagic(type){
document.getElementById("loading-"+type).classList.remove("hidden");
const input=document.getElementById(type+"-input").value;
const out=await callGemini(type==="translate"?"Dịch sang tiếng Việt:\n"+input:"Phân tích:\n"+input);
if(type==="translate")document.getElementById("trans-output").value=out;
else document.getElementById("analyze-output").textContent=out;
document.getElementById("loading-"+type).classList.add("hidden");
}

async function handleFileUpload(i){
const t=await i.files[0].text();
chapters=[t];
document.getElementById("reader-raw").textContent=t;
}

async function translateCurrentChapter(){
document.getElementById("reader-trans").textContent=
await callGemini("Dịch sang tiếng Việt:\n"+chapters[0]);
}

function cleanText(){
document.getElementById("cleaner-output").value=
document.getElementById("cleaner-input").value.replace(/<[^>]+>/g,"");
}

window.onload=loadSettings;
</script>

</body>
</html>
